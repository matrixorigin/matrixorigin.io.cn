# **SHOW PROCESSLIST**

## **语法说明**

`SHOW PROCESSLIST` 用于查看当前正在执行的线程列表（也称为进程列表），提供了关于 MatrixOne 服务器上所有活动连接和执行中查询的信息。

`SHOW PROCESSLIST` 用于监控和管理数据库中的活动，发现潜在问题，帮助查询性能问题，并帮助决策优化数据库的运行：

- 监控数据库活动：通过执行 `SHOW PROCESSLIST`，可以实时查看数据库中当前正在运行的查询和操作。这对于监控数据库活动并及时发现可能的性能问题非常有用。你可以了解哪些查询正在运行，它们的状态如何，以及是否有长时间运行或阻塞的查询、或者锁定、死锁或资源争用等。

- 终止查询：通过查看进程列表，可以确定要终止的查询 ID，并使用 `KILL` 命令终止具体的查询。这对于停止长时间运行的查询或解决死锁问题非常有用。

## **语法结构**

```
> SHOW PROCESSLIST;
```

查询出的表结构字段解释如下：

| 列名            | 类型     | 约束       | 备注               |
|----------------|---------|-----------|--------------------|
| node_id        | varchar | not null  | 节点 ID，用于在数据库集群中唯一标识不同的节点。在 MatrixOne 中，一个节点即为一个 CN（Compute Node）。<br> __Note:__ <br> - 在单机版本的 MatrixOne 中，通常只有一个节点，所有进程都运行在这个节点上，因此所有进程的 node_id 都相同。<br> - 在分布式版本的 MatrixOne 中，每个节点都有一个唯一的 node_id。系统租户可以查看所有正在执行的线程所在节点对应的 node_id，而非系统租户只能看到属于其租户下正在执行的线程的节点对应的 node_id。        |
| conn_id        | uint32  | not null  | 连接 ID，用于标识不同的数据库连接。如果需要终止某个数据库连接，可以使用 `KILL CONNECTION conn_id;` 命令来终止该连接。在数据库中，每个连接都会被分配一个唯一的 conn_id，用于标识该连接。<br> __Note:__ 系统租户可以查看所有 conn_id，非系统租户只能看到租户下的 conn_id。ID             |
| session_id     | varchar | not null  | 会话 ID         |
| account        | varchar | not null  | 租户 <br>__Note:__ 系统租户下可以看到所有租户的会话与租户名称，非系统租户只能看到自己租户的会话与租户名称。    |
| user           | varchar | not null  | 用户               |
| host           | varchar | not null  | 客户机端的主机名     |
| db             | varchar |           | 数据库名            |
| session_start  | varchar |           | 会话开始时间     |
| command        | varchar | not null  | 命令类型，如 COM_QUERY |
| info           | varchar |           | 当前或上一条 SQL 语句  |
| txn_id         | varchar | not null  | 当前或上一条事务 ID    |
| statement_id   | varchar |           | 当前或上一条语句 ID    |
| statement_type | varchar |           | 当前或上一条语句类型   |
| query_type     | varchar |           | 查询类型，如 DDL，DML 等 |
| sql_source_type| varchar |           | SQL 源类型，如 external_sql, internal_sql 等|
| query_start    | varchar |           | 查询开始时间          |

## **示例**

```sql
mysql> SHOW PROCESSLIST;
+--------------------------------------+---------+--------------------------------------+---------+--------------------------------------+----------------+---------+----------------------------+-----------+------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+----------------------------------+--------------------------------------+------------------+------------+-----------------+----------------------------+
| node_id                              | conn_id | session_id                           | account | user                                 | host           | db      | session_start              | command   | info                                                                                                                                                                                                                                                                                                                                                                                                                                                                               | txn_id                           | statement_id                         | statement_type   | query_type | sql_source_type | query_start                |
+--------------------------------------+---------+--------------------------------------+---------+--------------------------------------+----------------+---------+----------------------------+-----------+------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+----------------------------------+--------------------------------------+------------------+------------+-----------------+----------------------------+
| dd1dccb4-4d3c-41f8-b482-5251dc7a41bf |       1 | 97f85f80-2a5c-11ee-ae41-5ad2460dea4f | sys     | mo_logger                            | 127.0.0.1:6001 |         | 2023-07-24 19:59:27.005755 | COM_QUERY | COMMIT                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |                                  |                                      |                  |            | internal_sql    |                            |
| dd1dccb4-4d3c-41f8-b482-5251dc7a41bf |       8 | a056b7c6-2a5c-11ee-ae42-5ad2460dea4f | sys     | root                                 | 127.0.0.1:6001 | aab     | 2023-07-24 19:59:41.045851 | COM_QUERY | SHOW PROCESSLIST                                                                                                                                                                                                                                                                                                                                                                                                                                                                   | c207acc30a19432f8d3cbac387c6e520 | 421aadaa-2a68-11ee-ae5b-5ad2460dea4f | Show Processlist | Other      | external_sql    | 2023-07-24 21:22:56.907266 |
| dd1dccb4-4d3c-41f8-b482-5251dc7a41bf |      24 | 0915f91a-2a63-11ee-ae4d-5ad2460dea4f | sys     | 3bf028e0-aa43-4917-b82f-ed533c0f401e | 127.0.0.1:6001 | mo_task | 2023-07-24 20:45:33.762679 | COM_QUERY | select
                                                task_id,
                                                        task_metadata_id,
                                                        task_metadata_executor,
                                                        task_metadata_context,
                                                        task_metadata_option,
                                                        task_parent_id,
                                                        task_status,
                                                        task_runner,
                                                        task_epoch,
                                                        last_heartbeat,
                                                        result_code,
                                                        error_msg,
                                                        create_at,
                                                        end_at
                                                from mo_task.sys_async_task where task_id>17 AND task_runner='dd1dccb4-4d3c-41f8-b482-5251dc7a41bf' AND task_status=1 order by task_id limit 3 |                                  |                                      |                  |            | internal_sql    |                            |
| dd1dccb4-4d3c-41f8-b482-5251dc7a41bf |      36 | d8aa4060-2a67-11ee-ae59-5ad2460dea4f | sys     | 3bf028e0-aa43-4917-b82f-ed533c0f401e | 127.0.0.1:6001 | mo_task | 2023-07-24 21:20:00.009746 | COM_QUERY | select
                                                cron_task_id,
                                                task_metadata_id,
                                                task_metadata_executor,
                                                task_metadata_context,
                                                task_metadata_option,
                                                cron_expr,
                                                next_time,
                                                trigger_times,
                                                create_at,
                                                update_at
                                                from mo_task.sys_cron_task                                                                                                                                                                        |                                  |                                      |                  |            | internal_sql    |                            |
+--------------------------------------+---------+--------------------------------------+---------+--------------------------------------+----------------+---------+----------------------------+-----------+------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+----------------------------------+--------------------------------------+------------------+------------+-----------------+----------------------------+
4 rows in set (0.01 sec)
```
